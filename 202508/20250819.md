## Kubeflow

- Kubeflow은 Kubernetes 위에서 머신러닝(ML) 워크플로우를 쉽게 구축, 배포, 관리할 수 있도록 지원하는 오픈소스 플랫폼입니다
- 주된 목적은 복잡한 ML 파이프라인을 컨테이너화된 환경에서 확장 가능하고 재현성 있게 운영하는 것입니다

모델 학습 측면에서 Kubeflow는 다음과 같은 역할을 합니다:
	•	분산 학습 지원: TensorFlow, PyTorch, XGBoost 등의 프레임워크를 Kubernetes 클러스터 위에서 병렬/분산 학습 가능하도록 지원합니다.
	•	자동화된 파이프라인: 데이터 전처리, 학습, 평가, 배포 과정을 파이프라인으로 정의하여 재사용성과 자동화를 높일 수 있습니다.
	•	자원 관리 최적화: Kubernetes의 스케줄링 기능을 활용해 GPU, CPU, 메모리 등의 자원을 효율적으로 배분합니다.
	•	확장성: 필요할 때 학습 작업을 손쉽게 스케일 업/다운 할 수 있어 대규모 데이터 처리와 모델 학습에 유리합니다.

아래 예시는 Kubeflow Pipelines v2(KFP v2) 문법으로, `@dsl.component`와 `@dsl.pipeline`을 사용해 전처리 → 학습 → 평가 → (선택) 배포까지의 흐름을 보여줍니다

```python
# pip install kfp>=2
from kfp import dsl
from kfp.dsl import Input, Output, Dataset, Model, Metrics, component

@component
def preprocess(raw_uri: str, processed: Output[Dataset]):
    """원천 데이터 -> 정제 데이터셋 생성"""
    import pandas as pd
    import os

    # 예시: S3/PVC에서 파일을 읽어온다고 가정 (실환경은 SDK/FS로 마운트)
    df = pd.read_csv(raw_uri)
    df = df.dropna()
    os.makedirs(processed.path, exist_ok=True)
    df.to_csv(processed.path + "/data.csv", index=False)

@component
def train(processed: Input[Dataset], model: Output[Model], metrics: Output[Metrics]):
    """정제 데이터셋으로 모델 학습 & 메트릭 산출"""
    import json, os
    # 실제에선 sklearn/pytorch/tensorflow 등으로 학습
    os.makedirs(model.path, exist_ok=True)
    with open(model.path + "/model.bin", "wb") as f:
        f.write(b"dummy-weights")
    # 메트릭 기록(JSON)
    with open(metrics.path, "w") as f:
        f.write(json.dumps({"accuracy": 0.93}))

@component
def evaluate(model: Input[Model], metrics: Input[Metrics]):
    """모델/메트릭 확인(리포트 생성 등 확장 가능)"""
    import json
    with open(metrics.path) as f:
        m = json.load(f)
    print("Eval metrics:", m)

@dsl.pipeline(name="kfpv2-train-eval")
def pipeline(raw_uri: str = "data/train.csv"):
    p = preprocess(raw_uri=raw_uri)
    t = train(processed=p.outputs["processed"])
    evaluate(model=t.outputs["model"], metrics=t.outputs["metrics"])


from kfp import compiler
compiler.Compiler().compile(
    pipeline_func=pipeline,
    package_path="pipeline.yaml"   # IR YAML 생성
)
```
